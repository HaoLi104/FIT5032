<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SeniorConnect Hub</title>
    <!-- BR (A.2): Using Bootstrap for Responsiveness -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .navbar-brand {
            font-weight: bold;
            color: #0d6efd !important;
        }
        .card {
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .rating-stars span {
            cursor: pointer;
            font-size: 1.5rem;
            color: #ffc107;
        }
        .auth-container {
            max-width: 400px;
            margin: 5rem auto;
            padding: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

    <div id="app" class="container-fluid p-0">
        <!-- Main App View (Shown after login) -->
        <div v-if="loggedInUser">
            <!-- Navigation Bar -->
            <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
                <div class="container">
                    <a class="navbar-brand" href="#">SeniorConnect Hub</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <a class="nav-link" href="#" @click="activePage = 'community'">Community Hub</a>
                            </li>
                            <!-- BR (C.2): Role-based authentication - Admin Only -->
                            <li class="nav-item" v-if="isAdmin">
                                <a class="nav-link" href="#" @click="activePage = 'admin'">Admin Panel</a>
                            </li>
                        </ul>
                        <span class="navbar-text me-3">
                            Welcome, {{ loggedInUser.name }} ({{ loggedInUser.role }})
                        </span>
                        <button class="btn btn-outline-primary" @click="logout">Logout</button>
                    </div>
                </div>
            </nav>

            <!-- Page Content -->
            <main class="container py-5">
                <!-- Community Hub Page -->
                <div v-if="activePage === 'community'">
                    <h1 class="mb-4 text-center">Community Hub</h1>
                    <p class="text-center text-muted mb-5">Discover local events and connect with others.</p>
                    <!-- BR (B.2): Dynamically display data from events array -->
                    <div class="row">
                        <div class="col-md-6 col-lg-4 mb-4" v-for="event in events" :key="event.id">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">{{ event.title }}</h5>
                                    <h6 class="card-subtitle mb-2 text-muted">{{ event.date }}</h6>
                                    <p class="card-text">{{ event.description }}</p>
                                </div>
                                <div class="card-footer bg-white border-0">
                                    <!-- BR (C.3): Rating Feature -->
                                    <div class="d-flex justify-content-between align-items-center">
                                         <div>
                                            <strong>Avg. Rating: {{ getAverageRating(event) }} / 5</strong>
                                        </div>
                                        <div class="rating-stars">
                                            <span v-for="star in 5" @click="submitRating(event, star)">â˜…</span>
                                        </div>
                                    </div>
                                    <small class="text-muted">({{ event.ratings.length }} ratings)</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Panel Page -->
                <div v-if="activePage === 'admin' && isAdmin">
                    <h1 class="mb-4 text-center">Admin Panel</h1>
                    <p class="text-center text-muted mb-5">Manage users and site content.</p>
                    <div class="card">
                        <div class="card-header">
                            User Management
                        </div>
                        <div class="card-body">
                           <ul class="list-group">
                               <li v-for="user in users" :key="user.email" class="list-group-item d-flex justify-content-between align-items-center">
                                   <span>{{ user.name }} - {{ user.email }}</span>
                                   <span class="badge bg-primary rounded-pill">{{ user.role }}</span>
                               </li>
                           </ul>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Authentication View -->
        <div v-else>
            <!-- Login Form -->
            <div v-if="activePage === 'login'" class="auth-container">
                <h2 class="text-center mb-4">Login to SeniorConnect Hub</h2>
                <form @submit.prevent="login">
                    <div class="mb-3">
                        <label for="loginEmail" class="form-label">Email address</label>
                        <input type="email" class="form-control" id="loginEmail" v-model="loginForm.email" required>
                    </div>
                    <div class="mb-3">
                        <label for="loginPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="loginPassword" v-model="loginForm.password" required>
                    </div>
                    <!-- BR (B.1): Validation error message -->
                    <div v-if="authError" class="alert alert-danger">{{ authError }}</div>
                    <button type="submit" class="btn btn-primary w-100">Login</button>
                </form>
                <p class="mt-3 text-center">
                    Don't have an account? <a href="#" @click.prevent="activePage = 'register'">Register here</a>
                </p>
            </div>

            <!-- Registration Form -->
            <div v-if="activePage === 'register'" class="auth-container">
                <h2 class="text-center mb-4">Create an Account</h2>
                <form @submit.prevent="register">
                    <div class="mb-3">
                        <label for="regName" class="form-label">Full Name</label>
                        <!-- BR (C.4): Basic XSS protection by sanitizing input -->
                        <input type="text" class="form-control" id="regName" v-model="registerForm.name" @input="registerForm.name = sanitizeInput($event.target.value)" required>
                    </div>
                    <div class="mb-3">
                        <label for="regEmail" class="form-label">Email address</label>
                        <input type="email" class="form-control" id="regEmail" v-model="registerForm.email" required>
                    </div>
                    <div class="mb-3">
                        <label for="regPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="regPassword" v-model="registerForm.password" required>
                         <!-- BR (B.1): Validation hint -->
                        <div class="form-text">Password must be at least 6 characters long.</div>
                    </div>
                    <!-- BR (B.1): Validation error message -->
                    <div v-if="authError" class="alert alert-danger">{{ authError }}</div>
                    <button type="submit" class="btn btn-primary w-100">Register</button>
                </form>
                 <p class="mt-3 text-center">
                    Already have an account? <a href="#" @click.prevent="activePage = 'login'">Login here</a>
                </p>
            </div>
        </div>
    </div>

    <!-- BR (A.1): Using VueJS 3 Framework -->
    <script src="https://unpkg.com/vue@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const app = Vue.createApp({
            data() {
                return {
                    activePage: 'login', // 'login', 'register', or 'app'
                    loggedInUser: null,
                    users: [], // Will be loaded from localStorage
                    authError: '',
                    loginForm: {
                        email: '',
                        password: ''
                    },
                    registerForm: {
                        name: '',
                        email: '',
                        password: ''
                    },
                    // BR (B.2): Dynamic data for the community hub
                    events: [
                        { id: 1, title: 'Gentle Yoga in the Park', date: 'Every Wednesday at 10 AM', description: 'Join us for a relaxing and rejuvenating yoga session suitable for all fitness levels.', ratings: [] },
                        { id: 2, title: 'Digital Photography Workshop', date: 'July 30th, 2 PM', description: 'Learn the basics of using your smartphone camera to take beautiful photos.', ratings: [] },
                        { id: 3, title: 'Chess Club Meetup', date: 'Every Friday at 3 PM', description: 'Challenge your mind and meet new friends over a friendly game of chess.', ratings: [] },
                    ]
                }
            },
            computed: {
                // BR (C.2): Computed property to check for Admin role
                isAdmin() {
                    return this.loggedInUser && this.loggedInUser.role === 'Admin';
                }
            },
            methods: {
                // BR (C.1): Authentication Methods
                register() {
                    this.authError = '';
                    // BR (B.1): Input Validations
                    if (this.registerForm.password.length < 6) {
                        this.authError = 'Password must be at least 6 characters long.';
                        return;
                    }
                    if (this.users.find(user => user.email === this.registerForm.email)) {
                        this.authError = 'An account with this email already exists.';
                        return;
                    }

                    const newUser = {
                        name: this.registerForm.name,
                        email: this.registerForm.email,
                        password: this.registerForm.password, // In a real app, this should be hashed
                        role: 'User' // Default role for new users
                    };
                    
                    this.users.push(newUser);
                    this.saveUsers();
                    alert('Registration successful! Please log in.');
                    this.activePage = 'login';
                    this.registerForm = { name: '', email: '', password: '' };
                },
                login() {
                    this.authError = '';
                    const user = this.users.find(u => u.email === this.loginForm.email && u.password === this.loginForm.password);
                    
                    if (user) {
                        this.loggedInUser = user;
                        this.activePage = 'community'; // Default page after login
                        this.loginForm = { email: '', password: '' };
                    } else {
                        // BR (B.1): Validation error message
                        this.authError = 'Invalid email or password.';
                    }
                },
                logout() {
                    this.loggedInUser = null;
                    this.activePage = 'login';
                },

                // Data Persistence using Local Storage
                // HINT: Use Local Storage to persist data beyond the current session.
                saveUsers() {
                    localStorage.setItem('seniorconnect-users', JSON.stringify(this.users));
                },
                loadUsers() {
                    const savedUsers = localStorage.getItem('seniorconnect-users');
                    if (savedUsers) {
                        this.users = JSON.parse(savedUsers);
                    } else {
                        // Create a default admin user if no users exist
                        this.users.push({
                            name: 'Admin User',
                            email: 'admin@app.com',
                            password: 'password',
                            role: 'Admin'
                        });
                        this.saveUsers();
                    }
                },
                saveEvents() {
                    localStorage.setItem('seniorconnect-events', JSON.stringify(this.events));
                },
                loadEvents() {
                    const savedEvents = localStorage.getItem('seniorconnect-events');
                    if (savedEvents) {
                        this.events = JSON.parse(savedEvents);
                    }
                },

                // BR (C.3): Rating System Methods
                submitRating(event, rating) {
                    if (!this.loggedInUser) {
                        alert('You must be logged in to rate an event.');
                        return;
                    }
                    
                    const existingRatingIndex = event.ratings.findIndex(r => r.userId === this.loggedInUser.email);

                    if (existingRatingIndex > -1) {
                        // Update existing rating
                        event.ratings[existingRatingIndex].rating = rating;
                    } else {
                        // Add new rating
                        event.ratings.push({ userId: this.loggedInUser.email, rating: rating });
                    }
                    this.saveEvents(); // Persist ratings
                    alert(`You rated "${event.title}" ${rating} stars!`);
                },
                getAverageRating(event) {
                    if (event.ratings.length === 0) {
                        return 'N/A';
                    }
                    const total = event.ratings.reduce((sum, r) => sum + r.rating, 0);
                    return (total / event.ratings.length).toFixed(1);
                },

                // BR (C.4): Basic Security Method
                sanitizeInput(str) {
                    // This is a very basic example. In a real app, use a trusted library like DOMPurify.
                    const temp = document.createElement('div');
                    temp.textContent = str;
                    return temp.innerHTML;
                }
            },
            // Lifecycle hook to load data when the app is created
            created() {
                this.loadUsers();
                this.loadEvents();
            }
        });

        app.mount('#app');
    </script>

</body>
</html>
